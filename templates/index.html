<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Salt vs No-Salt Demonstrator</title>
    <!-- Bulma CSS for quick, clean styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <section class="section header-hero">
      <div class="container is-max-desktop">
        <div class="columns is-vcentered">
          <div class="column is-narrow">
            <label class="checkbox"><input id="darkToggle" type="checkbox" /> Dark</label>
          </div>
          <div class="column is-narrow">
            <img src="/static/logo.svg" alt="logo" style="width:56px;height:56px;" />
          </div>
          <div class="column">
            <h1 class="title">Salt vs No-Salt Demonstrator <span class="tag is-success is-light">Demo</span></h1>
            <p class="subtitle">Interactive demo: enter a password (or generate one), toggle <strong>Local-only</strong> to avoid sending plaintext to the server, and explore how salting changes hashes and attack surface.</p>
          </div>
          <div class="column is-narrow">
            <button id="generate" class="button is-light"><span class="icon"><i class="fa-solid fa-wand-magic-sparkles"></i></span> <span>Generate</span></button>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container is-max-desktop">
        <div class="card card-demo">
          <div class="content">
            <div class="field">
              <label class="label">Password</label>
              <div class="field has-addons">
                <div class="control is-expanded">
                  <input id="password" class="input" type="password" placeholder="Enter a demo password" aria-describedby="showPwHelp">
                </div>
                <div class="control">
                  <label class="checkbox" id="showPwLabel"><input id="showPwd" type="checkbox" /> Show</label>
                </div>
              </div>
              <p class="help" id="showPwHelp">Toggle to reveal the typed password (for demos only)</p>
            </div>

            <div class="field is-grouped">
              <div class="control">
                <button id="demoBtn" class="button is-primary">Run Demo</button>
              </div>
              <div class="control">
                <button id="exportBtn" class="button is-light">Export JSON</button>
              </div>
              <div class="control">
                <button id="exportCsvBtn" class="button is-light">Export CSV</button>
              </div>
              <div class="control">
                <button id="downloadPngBtn" class="button is-light">Download PNGs</button>
              </div>
              <div class="control">
                <label class="checkbox"><input id="localOnly" type="checkbox" checked> Local-only</label>
              </div>
              <div class="control">
                <label class="checkbox"><input id="useArgonLocal" type="checkbox"> Use Argon2 (local)</label>
              </div>

              <div class="control">
                <label class="checkbox"><input id="useBcryptLocal" type="checkbox"> Use bcrypt (local)</label>
              </div>
              <div class="control">
                <label class="checkbox"><input id="useScryptLocal" type="checkbox"> Use scrypt (local)</label>
              </div>

            </div>

            <div class="field is-grouped is-align-items-center">
              <div class="control">
                <label class="label">Argon2 time
                  <span class="tooltip" tabindex="0" aria-describedby="tip-argonTime">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-argonTime" role="tooltip" class="tooltip-text">Number of Argon2 iterations; higher values increase compute time. Demo-friendly: 1–3.</span>
                  </span>
                </label>
                <input id="argonTime" class="input" type="number" min="1" max="10" value="2" style="width:6rem" />
              </div>
              <div class="control">
                <label class="label">Memory (KB)
                  <span class="tooltip" tabindex="0" aria-describedby="tip-argonMem">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-argonMem" role="tooltip" class="tooltip-text">Memory required by Argon2 in KB. Large values (tens of MB) increase resistance but may freeze browsers.</span>
                  </span>
                </label>
                <input id="argonMem" class="input" type="number" min="8" value="65536" style="width:8rem" />
              </div>
              <div class="control">
                <label class="label">Parallelism
                  <span class="tooltip" tabindex="0" aria-describedby="tip-argonParallel">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-argonParallel" role="tooltip" class="tooltip-text">Number of lanes/threads Argon2 uses. Increasing can improve throughput on multicore systems.</span>
                  </span>
                </label>
                <input id="argonParallel" class="input" type="number" min="1" value="1" style="width:4rem" />
              </div>
              <div class="control">
                <p id="argonStatus" class="has-text-grey"></p>
              </div>
              <div class="control">
                <label class="label">bcrypt rounds
                  <span class="tooltip" tabindex="0" aria-describedby="tip-bcryptRounds">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-bcryptRounds" role="tooltip" class="tooltip-text">Cost factor for bcrypt; each round doubles compute time. Use low values for demos (8–12).</span>
                  </span>
                </label>
                <input id="bcryptRounds" class="input" type="number" min="4" max="15" value="10" style="width:5rem" />
              </div>
              <div class="control">
                <label class="label">scrypt N
                  <span class="tooltip" tabindex="0" aria-describedby="tip-scryptN">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-scryptN" role="tooltip" class="tooltip-text">Work factor (N) for scrypt; higher N increases memory & CPU. Reduce for CI/testing.</span>
                  </span>
                </label>
                <input id="scryptN" class="input" type="number" min="1024" value="16384" style="width:8rem" />
              </div>
              <div class="control">
                <label class="label">scrypt r
                  <span class="tooltip" tabindex="0" aria-describedby="tip-scryptR">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-scryptR" role="tooltip" class="tooltip-text">Block size parameter (r) for scrypt affecting memory usage; typical demo value is 1–8.</span>
                  </span>
                </label>
                <input id="scryptR" class="input" type="number" min="1" value="8" style="width:4rem" />
              </div>
              <div class="control">
                <label class="label">scrypt p
                  <span class="tooltip" tabindex="0" aria-describedby="tip-scryptP">
                    <i class="fa-solid fa-circle-info"></i>
                    <span id="tip-scryptP" role="tooltip" class="tooltip-text">Parallelization parameter (p) for scrypt; increases compute parallelism.</span>
                  </span>
                </label>
                <input id="scryptP" class="input" type="number" min="1" value="1" style="width:4rem" />
              </div>
              <div class="control">
                <p id="kdfStatus" class="has-text-grey"></p>
              </div>
            </div>

            <div id="strength" class="content">Strength: <strong id="strengthValue">—</strong></div>
          </div>
        </div>

        <div class="box" style="margin-top:1rem">
          <h2 class="title is-5">Results</h2>
          <div id="demoResults" style="display:block" aria-live="polite">No demo run yet.</div>
        </div>

        <div class="columns" style="margin-top:1rem">
          <div class="column">
            <h4 class="title is-6">Estimated crack time</h4>
            <canvas id="crackTimeChart" height="150"></canvas>
          </div>
          <div class="column">
            <h4 class="title is-6">Collision counts (unsalted vs salted)</h4>
            <canvas id="collisionChart" height="150"></canvas>
          </div>
        </div>

        <section class="box" style="margin-top:1rem">
          <h2 class="title is-5">Rainbow-table simulator</h2>
          <p class="help">Precomputed unsalted hashes for a small list of common passwords are used to demonstrate how unsalted hashes can be cracked instantly via a rainbow table, while salted hashes remain unique per user.</p>
          <div style="display:flex;gap:0.5rem;align-items:center;margin-top:0.5rem;">
            <div class="legend" aria-hidden="true">
              <span style="display:inline-block;width:12px;height:12px;background:#e15759;border-radius:2px;margin-right:6px;"></span> Unsalted (instant cracks)
              <span style="display:inline-block;width:12px;height:12px;background:#4caf50;border-radius:2px;margin:0 6px 0 12px"></span> Salted (unique)
            </div>
            <div style="margin-left:auto;">
              <span class="tooltip" tabindex="0" aria-describedby="tip-rainbow">
                <i class="fa-solid fa-circle-info"></i>
                <span id="tip-rainbow" role="tooltip" class="tooltip-text">"Instant cracks" means an unsalted hash appears in a precomputed table and could be looked up immediately by an attacker.</span>
              </span>
            </div>
          </div>

          <div class="field is-grouped is-align-items-center" style="margin-top:0.5rem;">
            <div class="control">
              <label class="label">Users per password</label>
              <input id="rainbowUsers" class="input" type="number" min="1" max="1000" value="100" style="width:6rem" />
            </div>
            <div class="control" style="margin-top:1.3rem">
              <label class="checkbox"><input id="rainbowUsePrecomputed" type="checkbox" checked> Use precomputed common-password table</label>
            </div>
            <div class="control" style="margin-top:1.3rem">
              <button id="rainbowBtn" class="button is-info">Run rainbow simulator</button>
            </div>
          </div>

          <div style="display:flex;align-items:center;margin-top:0.5rem;gap:0.75rem;">
            <div id="rainbowSpinner" class="loader" aria-hidden="true" style="display:none" title="Working"></div>
            <p id="rainbowStatus" class="help" style="color:#666;margin:0">Precomputed table: loading…</p>
            <div id="rainbowSummary" style="margin-left:auto;font-weight:600;">Unsalted instant cracks: <span id="rainbowInstantCount">0</span> &nbsp; • &nbsp; Salted unique: <span id="rainbowSaltedCount">0</span></div>
          </div>
          <div id="rainbowResults" style="margin-top:1rem">No simulation run yet.</div>
+          <div style="margin-top:0.5rem;display:flex;gap:0.5rem;align-items:center;">
+            <button id="rainbowDetailsBtn" class="button is-small is-light" aria-expanded="false" aria-controls="rainbowDetails">Show details</button>
+            <div class="sr-note" style="margin-left:auto;color:var(--muted);font-size:0.9rem">Details show sample common passwords only; avoid entering real passwords.</div>
+          </div>
+          <div id="rainbowDetails" role="region" aria-live="polite" aria-atomic="true">
+            <p class="sr-note">Instantly cracked passwords (unsalted):</p>
+            <ul id="rainbowDetailsList"></ul>
+          </div>
*** End Patch
          <div style="margin-top:1rem">
            <canvas id="rainbowChart" height="120"></canvas>
          </div>
        </section>

        <div style="margin-top:0.5rem">
          <small style="color:#666">Tip: Don't use real passwords — use generated or test passwords.</small>
        </div>
      </div>
    </section>

      <!-- Confirm modal for high Argon2 params -->
      <div id="confirmModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;">
        <div style="background:#fff;padding:1rem;border-radius:6px;min-width:320px;max-width:90%;box-shadow:0 6px 18px rgba(0,0,0,0.2);">
          <h3 style="margin-top:0">Warning: High Argon2 resource settings</h3>
          <p id="modalText">This configuration will use a lot of CPU/memory and may make your browser unresponsive. Proceed?</p>
          <div style="display:flex;gap:0.5rem;justify-content:flex-end;margin-top:0.5rem;">
            <button id="cancelModal">Cancel</button>
            <button id="confirmModalBtn" style="background:#e15759;color:#fff;border:none;padding:0.35rem 0.6rem;border-radius:4px;">Proceed</button>
          </div>
        </div>
      </div>

      <!-- Chart.js CDN -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <!-- First-run tutorial overlay (hidden by default) -->
      <div id="tutorialOverlay" aria-hidden="true" style="display:none;position:fixed;inset:0;background:rgba(3,6,11,0.6);z-index:60;align-items:center;justify-content:center;">
        <div style="background:var(--card);color:var(--text);padding:1.25rem;border-radius:8px;max-width:820px;margin:1rem;box-shadow:0 12px 30px rgba(2,6,23,0.5);">
          <h2 class="title is-4">Welcome to the Salt vs No-Salt demo</h2>
          <p>This short tour highlights key controls: <strong>Local-only</strong> (keeps everything in your browser), the <strong>Rainbow-table simulator</strong>, and the <strong>KDF toggles</strong> (Argon2 / bcrypt / scrypt).</p>
          <ol style="margin-top:0.75rem">
            <li><strong>Local-only:</strong> toggle to avoid sending plaintext to the server.</li>
            <li><strong>Rainbow-table simulator:</strong> shows instant cracks of unsalted hashes using a small precomputed list.</li>
            <li><strong>KDF toggles:</strong> enable a KDF locally to measure per-guess cost (slow parameters will warn).</li>
          </ol>
          <div style="display:flex;gap:0.5rem;justify-content:flex-end;margin-top:0.75rem;">
            <button id="dismissTutorial" class="button">Got it</button>
            <button id="neverShowTutorial" class="button is-light">Don't show again</button>
          </div>
        </div>
      </div>

    <script src="/static/app.js"></script>
  </body>
</html>